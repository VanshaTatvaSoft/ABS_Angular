<h1 mat-dialog-title class="ps-3 pt-2">My Profile</h1>

<form [formGroup]="myProfileForm" (ngSubmit)="submit()" class="profile-form">
  <mat-dialog-content>

    <!-- Name Field -->
    <mat-form-field appearance="outline" class="w-100">
      <mat-label>Name</mat-label>
      <input matInput formControlName="name" />
      @if(myProfileForm.get('name')?.hasError('required') && (myProfileForm.get('name')?.touched || myProfileForm.get('name')?.dirty)){
        <mat-error>
          Name is required.
        </mat-error>
      }
    </mat-form-field>

    <!-- Phone Field -->
    <mat-form-field appearance="outline" class="w-100">
      <mat-label>Phone No</mat-label>
      <input matInput formControlName="phoneNo" />
      @if(myProfileForm.get('phoneNo')?.touched || myProfileForm.get('phoneNo')?.dirty){
        <mat-error>
          @if(myProfileForm.get('phoneNo')?.hasError('required')){
            <span>Phone number is required</span>
          }
          @else if (myProfileForm.get('phoneNo')?.hasError('invalidPhone')) {
            <span>Enter valid phone number</span>
          }
        </mat-error>
      }
    </mat-form-field>

    <!-- Profile Image Upload -->
    <div class="profile-image-section">
      <div class="image-preview">
        @if(previewImage){
          <img [src]="previewImage" alt="Profile" />
        }
        @else {
          <div class="placeholder">
            <mat-icon>account_circle</mat-icon>
          </div>
        }
      </div>

      <button mat-raised-button color="primary" type="button" (click)="fileInput.click()">
        <mat-icon>upload</mat-icon> Upload Image
      </button>
      <input #fileInput type="file" hidden accept="image/*" (change)="onFileSelected($event)">
    </div>
    @if(fileError){
      <div class="error-message text-danger">
        {{ fileError }}
      </div>
    }

    <!-- Provider Availability -->
     @if(myProfileForm.get('isProvider')?.value){
       <div class="mt-2">
         <mat-slide-toggle formControlName="isAvailable" class="mb-2">Available</mat-slide-toggle>

         @if(myProfileForm.get('isAvailable')?.value){
           <div class="d-flex gap-2 mt-2">
             <mat-form-field appearance="outline">
               <mat-label>Set Start Time</mat-label>
               <input matInput [ngxTimepicker]="startTimePicker" formControlName="startTime" readonly>
               <ngx-material-timepicker #startTimePicker></ngx-material-timepicker>
             </mat-form-field>

             <mat-form-field appearance="outline">
               <mat-label>Set End Time</mat-label>
               <input matInput [ngxTimepicker]="endTimePicker" formControlName="endTime" readonly>
               <ngx-material-timepicker #endTimePicker></ngx-material-timepicker>
             </mat-form-field>
           </div>
         }

         <div>
           @if(myProfileForm.errors?.['timeSame']){
             <mat-error>
               Start time and end time cannot be the same
             </mat-error>
           } @else if (myProfileForm.errors?.['startAfterEnd']) {
             <mat-error>
               Start time must be before end time
             </mat-error>
           }
         </div>

       </div>
     }

  </mat-dialog-content>

  <!-- Actions -->
  <mat-dialog-actions align="end">
    <button type="button" mat-button (click)="close()">Cancel</button>
    <button type="submit" mat-flat-button color="primary" [disabled]="myProfileForm.invalid">Submit</button>
  </mat-dialog-actions>
</form>
